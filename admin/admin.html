<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel â€“ QuickPress</title>
  <meta charset="UTF-8">
</head>
<body>

<h2>Admin Panel â€“ Orders</h2>

<table border="1" cellpadding="10">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Address</th>
      <th>Service</th>
      <th>Quantity</th>
      <th>Status</th>
      <th>Update</th>
    </tr>
  </thead>
  <tbody id="ordersTable"></tbody>
</table>

<script type="module">
  // ðŸ”¹ Firebase imports
  import { auth, db } from "../firebase.js";
  import { onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { doc, getDoc, collection, getDocs, updateDoc }
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // ðŸ” AUTH + ROLE CHECK
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("Please login first");
      window.location.href = "../login.html";
      return;
    }

    // ðŸ”´ Check role from Firestore
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);

    if (!userSnap.exists() || userSnap.data().role !== "admin") {
      alert("Access denied âŒ (Admin only)");
      window.location.href = "../order.html";
      return;
    }

    // âœ… Only admin reaches here
    loadOrders();
  });

  // ðŸ“¦ Load all orders
  async function loadOrders() {
    const table = document.getElementById("ordersTable");
    table.innerHTML = "";

    const ordersSnap = await getDocs(collection(db, "orders"));

    ordersSnap.forEach((d) => {
      const o = d.data();

      table.innerHTML += `
        <tr>
          <td>${d.id}</td>
          <td>${o.address}</td>
          <td>${o.service}</td>
          <td>${o.quantity}</td>
          <td>
            <select id="status-${d.id}">
              <option ${o.status === "placed" ? "selected" : ""}>placed</option>
              <option ${o.status === "picked" ? "selected" : ""}>picked</option>
              <option ${o.status === "ironed" ? "selected" : ""}>ironed</option>
              <option ${o.status === "delivered" ? "selected" : ""}>delivered</option>
            </select>
          </td>
          <td>
            <button onclick="updateStatus('${d.id}')">Update</button>
          </td>
        </tr>
      `;
    });
  }

  // ðŸ”„ Update order status
  window.updateStatus = async function (orderId) {
    const newStatus =
      document.getElementById(`status-${orderId}`).value;

    await updateDoc(doc(db, "orders", orderId), {
      status: newStatus
    });

    alert("Status updated âœ…");
  };
</script>

</body>
</html>
